# 项目对象

1. 实现langZi\_SRC\_安全巡航0.98中资产监控模块
2. 作为插件独立化

# 项目进度

目前完成后端40%功能，前端已经完成30%功能，不过核心可以开始运作



## 主数据表

用来整理网站的数据信息，内部数据包含所有收监控域名的相关数据信息

![](/static/image/20190809222518.png)

![](/static/image/20190809222613.png)

## 监控域名表

监控表负责监控域名

![](/static/image/20190809222638.png)

主要数据是主域名

## 网址索引表

网址索引表负责对所有监控域名网址做数据统一

![](/static/image/20190809223429.png)

## 配置表

配置表负责扫描配置文件(注意这张表只能有一个方案)

![](/static/image/20190809222846.png)


在允许入库状态码的内容是一个列表，中间的逗号是英文的（参考python的列表格式）

![](/static/image/20190809222934.png)



## 网络资产表

网络资产表存储所有的网址(不仅仅是监控域名内)

![](/static/image/20190809223109.png)

可以用来做资产管理，搜索标题/网页关键词等信息

## 主机端口表

主机端口表存储监控域名对应的IP开放服务信息

![](/static/image/20190809223353.png)

## 资源消耗表

定期检测历史资源消耗，每两个小时盯控一次

![](/static/image/20190809223429.png)


**下面是一开始做到项目结构设计，可以不看**

# 项目规范

实现SRC资产监控，应包括如下：

1. 子域名定时监控(包括爆破，搜索引擎获取，友链爬行[黑名单机制])
2. C段定时监控(获取真实IP，扫描开放端口)
3. 开放端口定时监控，并获取运行服务(服务banner匹配)
4. 定时通过百度搜索引擎对子域名进行资产获取(google黑客语法)
5. 数据可视化操作，包含内容如下(域名，IP，端口，服务)，详细的数据包含如下(网址标题，网页内容，服务器类型，中间件信息，开放端口运行服务等)
6. 定期数据报表，新资产发送到邮箱提醒(或者其他方式实现)


# 使用技术栈：

python3，django，celery，nmap，bootstrap，mysql，docker，以及python相关库


# 分类归属：

不包含全系列的漏洞扫描验证功能，虽然隶属漏扫插件，放在资产收集文件夹比较符合

# 运行流程设计

1. 通过celery定时任务，每天跑baidu获取子域名数据，每天爆破子域名，最后定期爬行数据库已有数据
2. 通过socket，爆破中获取，以及第三方查询获取网址对应IP，通过修改host文件以及第三方查询判断时候存在CDN
3. 定期对获取到的IP进行端口扫描，获取banner，若发现http/s协议，对IP拼接成网址进行访问，获取的数据加载保存数据库
4. 每日生成数据报表，发送到邮箱

# 数据库设计

## 数据展示总表

数据来源：程序定期增删改查

数据用处：数据可视化展示，获取数据，定时推送报表

1. 网址(唯一索引)
2. 状态码
2. 标题
3. WEB容器
5. 服务器类型
6. 网页内容
7. IP
8. 端口 服务 字典
10. 百度获取该网址相关资产(网址)集合
11. 该网址隶属的主域名网址
12. 生成时间

## 主网址爬行表(唯一索引)

数据来源：子域名定时监控推送数据，作为中间过渡容器

数据用处：提供友链爬行(定时清空所有已经爬行标识)，所有网址唯一主表，

1. 网址
2. 是否爬行标识
4. IP(外键关联下一张表)
3. 时间

## IP地址表

数据来源：通过验证无CDN的网址对应IP

数据用处：开放端口资源信息

1. IP
2. 开放端口服务 字典
4. 服务器类型
4. 存在http/s的网址集合(网址+标题)
5. 所属地区
6. 时间

## 其他网址信息

数据来源：存储爬行所有网址

数据用处：网络资产收集

1. 网址
2. 标题
3. 脚本语言
4. WEB容器
5. 时间

# 流程设计

项目运行需要两个功能类，分成及时获取和非及时获取。

及时获取：网址的信息，比如网址，标题，内容，状态码，脚本语言，web容器，服务器类型

非及时获取：IP（CDN），开放端口，服务，关联IP

具体流程功能设计，下图是我在顶夜班的时候画的，半夜脑子不清醒，大概就是先这样，在这样，最后那样....

![](/static/image/IMG_20190805_205958.jpg)

![](/static/image/IMG_20190805_210005.jpg)

# 相关配置

配置文件设置状态码，符合状态码要求则入库

status = [200,301,302]

子域名黑名单机制，一个文本，其中包括网址域名黑名单，可做泛解析判断排除或者排除指定域名

    xxx.com
    a.xx.ca.com
    ...
    
相关数据库，线程，推送邮箱账号密码配置信息。


